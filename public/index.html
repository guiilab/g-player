<!--

Index.js
G-Player Data Visualization

- Creates the DOM
- Loads dependencies
- Initializes the mapping tool (Leaflet.js)
- Configures the Map settings
- Configures the User Interface settings

Authors:
@alexjohnson505

-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link rel="icon" href="../../favicon.ico"> -->

  <title>G-Player Data Visualization | Visualize Data</title>

  <!-- External Style Sheets -->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/messenger/1.4.0/css/messenger.css" />
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/messenger/1.4.0/css/messenger-theme-air.css" />
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.2.3/leaflet.draw.css" />

  <!-- Local Style Sheets -->
  <link href="lib/mprogress.min.css" rel="stylesheet" />
  <link href="css/style.css" rel="stylesheet" />
</head>
<body>
  <i id="loading" class="fa fa-cog fa-spin" style="display: none;"></i>

  <!-- Page Content -->
  <div id="wrapper">

    <!-- Left Options Sidebar -->
    <div id="sidebar-wrapper">
      <ul class="sidebar-nav">


        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingOne">
              <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                  <i class="fa fa-leanpub"></i> Select Map
                </a>
              </h4>
            </div>
            <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
              <div class="panel-body">
                <form class="form">

                  <label>Select Game</label>
                  <select class="form-control">
                    <option>Fallout</option>
                    <option>...etc</option>
                  </select><br>

                  <label>Select Map</label>
                  <select class="form-control">
                    <option>Intro House</option>
                  </select>
                </form>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingTwo">
              <h4 class="panel-title">
                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                  <i class="fa fa-table"></i> Select Data
                </a>
              </h4>
            </div>
            <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
              <div class="panel-body" style="padding: 0px;">
                <li onclick="QueryBuilder.open();"><a><i class="fa fa-search"></i>Query Database</a></li>
                <li onclick="MAP.getData();"><a><i class="fa fa-database"></i>Get All Data</a></li>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingThree">
              <h4 class="panel-title">
                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                  <i class="fa fa-filter"></i> Filter Data
                </a>
              </h4>
            </div>
            <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
              <div class="panel-body">
                <div class="checkbox">
                  <div class="checkbox">
                   <label>
                     <input type="checkbox" id="toggle_heatmap">Player Heatmap
                   </label>
                 </div>
                 <label style="text-decoration: line-through;">
                   <input type="checkbox" disabled="disabled">Player Deaths
                 </label>
               </div>
               <div class="checkbox">
                 <label style="text-decoration: line-through;">
                   <input type="checkbox" disabled="disabled">NPC Actions
                 </label>
               </div>
             </div>
           </div>
         </div>
       </div>

       <div class="panel-group tools" id="accordion2" role="tablist" aria-multiselectable="true">
         <div class="panel panel-default">
           <div class="panel-heading" role="tab" id="tools">
             <h4 class="panel-title">
               <a data-toggle="collapse" data-parent="#accordion2" href="#toolsCollapse" aria-expanded="true" aria-controls="toolsCollapse">
                 <i class="fa fa-wrench"></i> Tools
               </a>
             </h4>
           </div>
           <div id="toolsCollapse" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="tools">
             <div class="panel-body" style="padding: 0px;">
               <li><a href="uploader.html"><i class="fa fa-database"></i>Upload Data</a></li>
               <li><a><i class="fa fa-gamepad"></i>Add a Game</a></li>
               <li><a><i class="fa fa-leanpub"></i>Add a Map</a></li>
               <li onclick="MAP.exportCSV();"><a><i class="fa fa-cloud-download"></i>Export .CSV</a></li>
             </div>
           </div>
         </div>
       </div>
     </ul>
   </div>

   <!-- Leaflet.js Map -->
   <div id="map"></div>

   <!-- Map Key -->
   <div id="key">
     <p><b>Game : Map Name</b></p>
     <p>User IDs</p>
     <p>14k Locations</p>
     <p>20k Events</p>
     <div class="content"></div>
   </div>

   <!-- Status Bar -->
   <div id="status">status</div>

 </div><!-- /#wrapper -->

<!-- Query Builder Modal -->
<div class="modal fade" id="query-builder-modal" tabindex="-1" role="dialog" aria-labelledby="queryBuilderLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="queryBuilderLabel">
          <ul class="nav nav-tabs">
            <li role="presentation" class="custom active" onclick="QueryBuilder.mode('custom')"><a href="#">Query Builder</a></li>
            <li role="presentation" class="preset"  onclick="QueryBuilder.mode('preset')"><a href="#">Preset Queries</a></li>
          </ul>  
        </ul>
      </div>
      <div class="modal-body col-sm-12"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="QueryBuilder.queryDatabase();"><i class="fa fa-database"></i> QUERY</button>
      </div>
    </div>
  </div>
</div>

 <!-- External Javascript Dependencies -->
 <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
 <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
 <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
 <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
 <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.js"></script>
 <script src="http://cdnjs.cloudflare.com/ajax/libs/messenger/1.4.0/js/messenger.min.js"></script>
 <script src="http://cdnjs.cloudflare.com/ajax/libs/messenger/1.4.0/js/messenger-theme-future.js"></script>
 <script src="http://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.2.3/leaflet.draw.js"></script>

 <!-- Libraries Hosted Locally --> 
 <script src="lib/heatmap.min.js"></script>
 <script src="lib/leaflet-heatmap.js"></script>
 <script src="lib/mprogress.min.js"></script>

 <!-- App Functionality -->
 <script src="js/app.js"></script>
 <script src="js/map.js"></script>
 <script src="js/key-mappings.js"></script>
 
 <!-- Query Builder Functionality -->
 <script src="js/query-builder.js"></script>

 <!-- Page-Specific Javascript -->
 <script>

  // Save window size.
  var windowWidth  = $(document).width();
  var windowHeight = $(document).height();

  /*************************
         Setup MAP
   *************************/

  // Initialize Map's Size
  $("#map").css("width", windowWidth);
  $("#map").css("height", windowHeight);

  var settings = {

  	// Save data
  	data : null,

  	// enable heatmap
  	heatmap : true,

    // Global scale factor.
    // Helps to max points (ranging from -10,000 to 10,000)
    // to their coordinate points on a geo projection.
    scale : 100,

    map : {

      // Save map configuration
      url: "/fallout/intro.png",
      name: "Position_introhouse",
      title: "",
      width : 1600,
      height : 1178,

      // Map player locations to their points
      // on the map. Manually offset for accuracy.
      // Multiplied to base
      offset : {
        x : 650,
        y : 550,
      },

      // Map player locations to their points
      // on the map. Manually scale for accuracy.
      // added to base
      scale : {
        x : 0.45,
        y : 0.45,
      }
    },
  };

  // Given map size, and scale factor,
  // determin the latitude/longitude bounds.
  var latitudeDistance = settings.map.height / settings.scale;
  var longitudeDistance = settings.map.width / settings.scale;

  // Note: Lat/Long is represented as [Latitude (y), Longitude (x)].
  // Take care when converting from cartesian points, to lat/long.        
  var imageBounds = [[0, 0], [latitudeDistance, longitudeDistance]];

  // Define center of map
  var mapCenter = [latitudeDistance / 2, longitudeDistance / 2];

  // Define Map Parameters
  var map = L.map('map', {
    
    // Initialize Zoom Limits
    minZoom: 6,
    maxZoom: 10,

    // Support Leaflet.draw
    drawControl: false,
  }).setView(mapCenter, 1);

  // Add image overlay to map
  L.imageOverlay('img/maps/' + settings.map.url, imageBounds).addTo(map);

  /***************************
     Setup UI / Side Options
  ****************************/

  var SideOptionsToggle = L.Control.extend({
    options: { position: 'topleft' },

    // Create a button for toggling left nav
    onAdd: function (map) {
      
      // create the control container with a particular class name
      var button = L.DomUtil.create('div', 'toggle-side-options leaflet-control leaflet-bar');
      var icon = L.DomUtil.create('i', 'fa fa-bars', button);

      // Add Listener
      L.DomEvent.addListener(button, 'click', function(){
        $("#wrapper").toggleClass("toggled");
      });

      return button;
    }
  });

  map.addControl(new SideOptionsToggle());

  // Toggle Side Options Meny
  $("#toggle-menu").click(function(e) {
    e.preventDefault();
    $("#wrapper").toggleClass("toggled");
  });

  // Show/Hide Heatmap
  $('#toggle_heatmap').change(function(e) {
    
  	// Enable
    if ($('#toggle_heatmap').is(':checked')) {
    	MAP.addHeatmap(settings.data);
    
	  //	Disable
    } else {
    	map.removeLayer(MAP.heatmapLayer)
    }
  });

  /***************************
     Initialize Leaflet.draw
     Enables shape creation/selection
     https://github.com/Leaflet/Leaflet.draw#using
  ****************************/

  // Initialise the FeatureGroup to store editable layers
  var drawnItems = new L.FeatureGroup();

  // Initialize empty player
  map.addLayer(drawnItems);

  // Initialise the draw control and pass it the FeatureGroup of editable layers
  var drawControl = new L.Control.Draw({
      
      // Disable certain shapes
      draw : {circle: false, polyline: false, marker: false,},

      // Define layer
      edit: { featureGroup: drawnItems }
  });

  // Add Drawing Tools
  map.addControl(drawControl);

  // Listen for draw actions
  map.on('draw:created', function(e) {

      var type = e.layerType,
          layer = e.layer;

      drawnItems.addLayer(e.layer);

      if (type === 'polygon') {
        console.log(e)
      }

      if (type === 'rectangle') {
        console.log(e)
      }
  });

  
</script>
</body>
</html>
