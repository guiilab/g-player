<!--

index.html
G-Player Data Visualization

- Creates the DOM
- Loads dependencies
- Initializes the mapping tool (Leaflet.js)
- Configures the Map settings
- Configures the User Interface settings

Created: February 23, 2015
Authors:
Alex Johnson @alexjohnson505

-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link rel="icon" href="../../favicon.ico"> -->

  <title>G-Player Data Visualization | Visualize Data</title>

  <!-- External Style Sheets -->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/messenger/1.4.0/css/messenger.css" />
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/messenger/1.4.0/css/messenger-theme-air.css" />
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" />

  <!-- Local Style Sheets -->
  <link href="css/style.css" rel="stylesheet" />

  <!-- Favicon -->
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

</head>
<body>

  <div id="loading">
    <i class="fa fa-cog fa-spin"></i>
  </div>

  <!-- Page Content -->
  <div id="wrapper">

    <!-- Left Options Sidebar -->
    <div id="sidebar-wrapper"></div>

   <!-- Leaflet.js Map -->
   <div id="map"></div>

   <!-- Map Information -->
   <div id="legend"></div>

   <!-- Popup Menu -->
   <div id="popup-menu"></div>
  
   
 </div><!-- /#wrapper -->

 <!-- External Javascript Dependencies -->
 <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
 <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
 <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
 <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
 <script src="http://cdnjs.cloudflare.com/ajax/libs/messenger/1.4.0/js/messenger.min.js"></script>
 <script src="http://cdnjs.cloudflare.com/ajax/libs/messenger/1.4.0/js/messenger-theme-future.js"></script>
 <script src="http://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>
 <script src="http://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.3.0/bootbox.min.js"></script>

 <!-- Libraries Hosted Locally --> 
 <script src="lib/heatmap.min.js"></script>
 <script src="lib/leaflet-heatmap.js"></script>
 <script src="lib/leaflet.label.js"></script>

 <!-- Load Settings -->
 <script src="config/settings.js"></script>

 <!-- App Functionality -->
 <script src="js/visualizer.js"></script>
 <script src="js/ui.js"></script>
 <script src="js/heatmap.js"></script>
 <script src="js/exporter.js"></script>

 <!-- Page-Specific Javascript -->
 <script>

  /*************************
       Load Tempalates
   *************************/

   $("#popup-menu").load('templates/menu-popup.html', function(result){

   })

  $("#sidebar-wrapper").load('templates/menu-left.html', function(result){

      // Load Options
      UI.loadOptions();

      // Default Settings
      UI.setGame("Fallout New Vegas");
      
      // Initialize side nav
      UI.addToggleAbleSideNavigation();

  });

  // Load side options template
  $("#legend").load('templates/menu-right.html', function(result){
    
    // Available Actions
    UI.filters.create();
    
    // Initialize Multiselect
    $(".action-select").select2();

    /***************************
         Watch form Values
    ****************************/

    // Watcher
    $(".action-select").on("change", function (e) { 
      
      // Get list of selected actions
      var actions = $(".action-select").val();

      // Save to settings
      settings.actions = actions;
      
      UI.getListOfAvailablePlayerIDs();

    });

    $('#select-game').on('change', function(){
      var selected = $(this).find("option:selected").val();
      UI.setGame(selected);
    });

    $('#select-map').on('change', function(){
      var selected = $(this).find("option:selected").val();
      
      settings.data = null;
      
      // Remove previous data
      Visualizer.clear();
      
      UI.setMap(selected);
    });

    // Show/Hide Heatmap
    $('#toggle_heatmap').change(function(e) {
      
      // Enable
      if ($('#toggle_heatmap').is(':checked')) {
        Heatmap.addHeatmap(settings.data);
      
      //  Disable
      } else {
        map.removeLayer(Heatmap.heatmapLayer)
      }
    });
    
  });

  /*************************
         Setup MAP
   *************************/

  // Initialize Map's Size
  $("#map").css("width", $(document).width());
  $("#map").css("height", $(document).height());

  // Define Map Parameters
  var map = L.map('map', { minZoom: 2, maxZoom: 8 });

  map.on('click', function(e) {

    console.log(Visualizer.unformatData({ 
      latitude : e.latlng.lat,
      longitude : e.latlng.lng,
    }));
    
  });
  
</script>
</body>
</html>
